---
tags:
  - CSharp
  - IT
Источник: Дж. Рихтер CLR via C#
завершена: true
---
## Приведение типов##
---
В программировании часто прибегают к преобразованиям типов. Грубо говоря, преобразование типов это указание компилятору считать объект типа А объектом типа Б.

В C# реализуется обратная совместимость классов. Допустим у нас класс В наследуется от класса А, тогда объекты типа В можно легко и непринуждённо преобразовать к типу А:
```
B b1 = new B();
A a1 = (A)b1;
```

А вот попытка явно преобразовать объект класса А к типу В уже не получится, появится ошибка.

## Операторы is и as
---
Чтобы на этапе разработки и компиляции не возникали ошибки можно использовать операторы ***is*** и ***as***. 
Разберём их подробнее.
Оператор ***is*** проверяет совместимость типа объекта с заданным типом и возвращает ***true***, если объект и тип совместимы, и ***false*** в обратном случае. Обычно используется с оператором if:
```
if (a is A)
{
...
}
```
Оператор ***as*** используется для явного преобразования и преобразовывает объект к указанному типу. Если это возможно, то возвращается ссылка на объект, в ином случае возвращается ***null***. Если преобразование не удалось и в коде используется данный объект, то выбросится исключение ***NullReferenceException***. Оператор ***as*** используют так:
```
var a1 = b1 as A
if (a1 != null)
{
...
}
```
Если преобразование удалось, то `а1` будет иметь значение, отличное от `null` и выполнится код в блоке `if`, в ином случае блок `if` будет пропущен.
## Операторы явного(explicit) и неявного(implicit) преобразования
---
Бывают такие случаи, когда нам необходимо объект одного типа преобразовать к объекту другого типа. Например, объект типа *Byte* мы хотим привести к типу *Int32*. Для этого можно использовать оператор неявного (***implicit***) преобразования. Если же нам необходимо наоборот, привести объект типа *Int32* к типу *Byte*, то необходимо использовать оператор явного (***explicit***) преобразования, который в коде выглядит так:
```
int a = 300;
byte b = (byte)a;
```
Компилятор C# умеет приводить один примитивный тип в другой примитивный. Но если нам необходимо привести пользовательский один тип в другой, или пользовательский в примитивный и наоборот, необходимо в типе указать операторы неявного(***implicit***) и явного(***explicit***) преобразования. В коде описание операторов преобразования выглядит так:
```
internal sealed class Point {
	public static implicit(или explicit) operator Point (...) { ... }
}
```
Компилятор C# требует, чтобы метод был открытым(***public***) и статичным(***static***). После ключевого слова ***implicit*** для неявного преобразования и ***explicit*** для явного преобразования, мы сообщаем компилятору, что метод представляет собой оператор преобразования (***operator***). Затем, указывается тип возвращаемого объекта (***Point*** в данном случае), в круглых скобках указывается объект, который будет преобразован и в фигурных скобках записывается тело метода.

>[!attention]+ Внимание!
>C# генерирует код вызова операторов неявного преобразования в случае, когда используется выражение приведения типов. В случае использования слов ***is*** и ***as*** операторы неявного преобразования <u>НИКОГДА</u> не вызываются.
